cmake_minimum_required(VERSION "3.26")

project(CS161-Minesweeper)

FILE(GLOB_RECURSE SOURCES CONFIGURE_DEPENDS main.cpp GameBoard/*.cpp HomeWindow/*.cpp Square/*.cpp Style/*.cpp)

set(TARGET_NAME Game)
set(CMAKE_EXPORT_COMPILE_COMMANDS OFF)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

set(QT6_DIR D:/Unsorted/QT/6.6.0/mingw_64)
set(QT_COMPONENTS Widgets)

set(CMAKE_PREFIX_PATH ${QT6_DIR})
find_package(Qt6 REQUIRED COMPONENTS ${QT_COMPONENTS} Widgets)

include_directories(${QT6_DIR}/include)

qt_standard_project_setup()
set(CMAKE_AUTORCC ON)

qt_add_executable(${TARGET_NAME} ${SOURCES})

foreach(LIB ${QT_COMPONENTS})
    target_link_libraries(${TARGET_NAME} PRIVATE Qt6::${LIB})
endforeach()

set_target_properties(${TARGET_NAME} PROPERTIES WIN32_EXECUTABLE ON)

set(BUILD_DIR ${PROJECT_SOURCE_DIR}/build)
set(DIST_DIR ${BUILD_DIR}/dist)
set(CMAKE_INSTALL_PREFIX ${DIST_DIR})

install(TARGETS ${TARGET_NAME}
    BUNDLE DESTINATION .
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
)
qt_generate_deploy_app_script(
    TARGET ${TARGET_NAME}
    OUTPUT_SCRIPT deploy_script
    NO_UNSUPPORTED_PLATFORM_ERROR
)
install(SCRIPT ${deploy_script})